<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cat√°logo de T√™nis Premium e Importados</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/index.css">
	<style>
		.em-breve {
			display: flex;
			align-items: center;
			justify-content: center;
			height: 300px;
			background: #111;
			color: #888;
			font-size: 1.2rem;
			border-radius: 12px;
			border: 1px dashed #333;
		}

		/* ZOOM MOBILE OTIMIZADO */
		.zoom-area {
			position: relative;
			overflow: hidden;
			background: #000;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 70vh; 
			touch-action: none;
		}
		
		.zoom-area img {
			transition: transform 0.3s ease;
			max-height: 100%;
			max-width: 100%;
			object-fit: contain;
			cursor: zoom-in;
		}
		
		.zoomed { cursor: grab; }
		
		@media (max-width: 768px) {
			.zoom-area { height: 60vh; }
		}
		
		.valor-box { margin-bottom: 1rem; }
		.valor-principal { font-size: 1.1rem; font-weight: bold; margin-bottom: 0; }
		.valor-sub { font-size: 0.85rem; color: #666; display: block; margin-bottom: 0.4rem; }
		.valor-pix { color: #198754; font-weight: bold; font-size: 1.1rem; margin-bottom: 0; }
		
		/* ESTILOS DO CARRINHO */
		.carrinho-flutuante {
			position: fixed;
			bottom: 20px;
			right: 20px;
			background-color: #25D366;
			color: white;
			border: none;
			border-radius: 50px;
			padding: 12px 22px;
			font-size: 1rem;
			font-weight: bold;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
			z-index: 1050;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		#contadorCarrinho {
			background-color: #ffc107;
			color: #000;
			border-radius: 50%;
			padding: 2px 8px;
			font-size: 0.9em;
		}
		
		.btn-add-carrinho {
		    background-color: #198754; 
		    color: white;
		    border: none;
			margin-top: 10px;
			font-weight: 600;
			padding: 8px;
		}
		
		.card-img-top { cursor: zoom-in; }
	</style>
</head>

<body>
	<div class="container py-4">
		<h1 class="text-center mb-4">Cat√°logo de T√™nis Premium</h1>

		<div class="row mb-4">
			<nav class="col-12 d-flex flex-wrap gap-2 justify-content-center">
				<a href="index.html" class="btn-grad btn">In√≠cio</a>
				<a href="perfumes.html" class="btn-grad btn">Perfumes Importados</a>
				<a href="arabes.html" class="btn-grad btn">Perfumes √Årabes</a>
				<a href="brand.html" class="btn-grad btn btn-outline-primary">Brand Collection</a>
				<a href="tenis.html" class="btn-grad btn active">T√™nis</a>
			</nav>
		</div>

		<div class="row mb-4">
			<div class="col-md-6 mx-auto">
				<input type="text" id="search" class="form-control" placeholder="üîç Buscar modelo ou marca...">
			</div>
		</div>

		<div class="categorias-header mb-3">
			<h5>Filtrar por Marca</h5>
			<div class="categorias-lista" id="marcasTabs"></div>
		</div>

		<div id="catalogoContainer"></div>
	</div>

	<div class="modal fade" id="modalImagem" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<div class="modal-content bg-dark text-light border-0">
				<div class="modal-header border-0">
					<h5 class="modal-title">Visualiza√ß√£o do Produto</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body p-0 text-center" id="modalConteudo"></div>
			</div>
		</div>
	</div>

	<button id="abrirCarrinho" class="carrinho-flutuante" onclick="abrirModalCarrinho()">
	    üõí Meu Pedido (<span id="contadorCarrinho">0</span>)
	</button>

	<div class="modal fade" id="modalCarrinho" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">üõí Seu Pedido</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<div id="itensCarrinhoLista"></div>
				</div>
				<div class="modal-footer d-flex flex-column align-items-stretch">
					<p class="h4 text-end mb-3" id="carrinhoTotal">Total Estimado: R$ 0,00</p>
					<button type="button" class="btn btn-success btn-lg w-100" onclick="finalizarPedidoWhatsApp()">
						‚úÖ Finalizar Pedido no WhatsApp
					</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		let tenis = [];
		const NUMERO_WHATSAPP = "5537998195214";
		let carrinho = [];

		// --- GEST√ÉO DO CARRINHO ---
		function carregarCarrinho() {
			carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
			atualizarContadorCarrinho();
		}
		
		function salvarCarrinho() {
		    localStorage.setItem('carrinho', JSON.stringify(carrinho));
		    atualizarContadorCarrinho();
		}

		function atualizarContadorCarrinho() {
			document.getElementById('contadorCarrinho').innerText = carrinho.length;
		}

		function adicionarAoCarrinho(nome, marca, venda) {
			carrinho.push({ nome, marca, preco: venda, tipo: 'T√™nis', id: Date.now() });
			salvarCarrinho();
			alert(`${nome} adicionado ao seu pedido!`);
		}
		
		function removerDoCarrinho(id) {
		    carrinho = carrinho.filter(item => item.id !== id);
		    salvarCarrinho();
			if (carrinho.length === 0) {
				const modalInstance = bootstrap.Modal.getInstance(document.getElementById('modalCarrinho'));
				if (modalInstance) modalInstance.hide();
			} else {
				abrirModalCarrinho(true); 
			}
		}
		
		function abrirModalCarrinho(reabrir = false) {
			if (carrinho.length === 0 && !reabrir) {
				alert("Seu pedido est√° vazio!");
				return;
			}
			
			const listaContainer = document.getElementById('itensCarrinhoLista');
			let html = `<ul class="list-group list-group-flush">`;
			let total = 0;

			carrinho.forEach(item => {
				total += parseFloat(item.preco.replace('R$', '').replace('.', '').replace(',', '.').trim()) || 0;
				html += `
					<li class="list-group-item d-flex justify-content-between align-items-center">
						<div><strong>${item.nome}</strong><br><small class="text-muted">${item.preco}</small></div>
						<button class="btn btn-sm btn-danger" onclick="removerDoCarrinho(${item.id})">Remover</button>
					</li>`;
			});

			listaContainer.innerHTML = html + `</ul>`;
			document.getElementById('carrinhoTotal').innerText = `Total Estimado: ${total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
			
			if (!reabrir) {
                const m = new bootstrap.Modal(document.getElementById("modalCarrinho"));
                m.show();
            }
		}

		function finalizarPedidoWhatsApp() {
		    let msg = "Ol√°! Gostaria de encomendar os seguintes modelos:\n\n";
		    carrinho.forEach((item, i) => msg += `${i+1}. ${item.nome} (${item.marca}) - ${item.preco}\n`);
		    window.open(`https://wa.me/${NUMERO_WHATSAPP}?text=${encodeURIComponent(msg)}`, '_blank');
		}

		// --- RENDERIZA√á√ÉO DO CAT√ÅLOGO ---
		function renderizarMarcas(lista) {
			const marcas = [...new Set(lista.map(p => p.Marca))].sort();
			const tabs = document.getElementById("marcasTabs");
			const container = document.getElementById("catalogoContainer");
			tabs.innerHTML = ""; container.innerHTML = "";

			marcas.forEach(marca => {
				const marcaId = marca.toLowerCase().replace(/[^a-z0-9]+/g, "-");
				tabs.innerHTML += `<button onclick="scrollToSection('${marcaId}')">${marca}</button>`;
				const produtos = lista.filter(p => p.Marca === marca);
				
				container.innerHTML += `
					<section id="${marcaId}" class="mb-5">
						<h3 class="text-gradient mb-3">${marca}</h3>
						<div class="row g-3">
							${produtos.map(p => {
                                // C√°lculo de Valores
                                const valorLimpo = parseFloat(p.Venda.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
                                const valorPix = (valorLimpo * 0.9).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

								return `
								<div class="col-6 col-md-4 col-lg-3">
									<div class="card h-100">
										<img src="${p.Imagem1}" class="card-img-top" onclick='abrirModal(${JSON.stringify(p).replace(/"/g, "&quot;")})'>
										<div class="card-body">
											<h5>${p.Modelos}</h5>
											<p class="mb-1 text-muted">Marca: ${p.Marca}</p>
											<p class="mb-2"><strong>Tamanho:</strong> ${p.Tamanho || 'Consultar'}</p>
											
											<div class="valor-box">
												<p class="valor-principal">${p.Venda}</p>
												<span class="valor-sub">em at√© 3x sem juros</span>
												<p class="valor-pix">${valorPix}</p>
												<span class="valor-sub">√† vista no Pix (10% OFF)</span>
											</div>

											<button onclick="adicionarAoCarrinho('${p.Modelos}', '${p.Marca}', '${p.Venda}')" class="btn btn-sm btn-add-carrinho w-100">üõçÔ∏è Adicionar ao Pedido</button>
										</div>
									</div>
								</div>`;
							}).join("")}
						</div>
					</section>`;
			});
		}

		function scrollToSection(id) { document.getElementById(id).scrollIntoView({ behavior: "smooth" }); }

		// --- ZOOM E CARROSSEL ---
		function abrirModal(produto) {
			const imagens = [produto.Imagem1, produto.Imagem2, produto.Imagem3, produto.Imagem4, produto.Imagem5, produto.Imagem6, produto.Imagem7].filter(img => img && img.trim() !== "");
			document.getElementById("modalConteudo").innerHTML = `
				<div id="carouselImagens" class="carousel slide" data-bs-interval="false">
					<div class="carousel-inner">
						${imagens.map((img, i) => `
							<div class="carousel-item ${i === 0 ? 'active' : ''}">
								<div class="zoom-area"><img src="${img}" class="zoomable"></div>
							</div>`).join("")}
					</div>
					<button class="carousel-control-prev" data-bs-target="#carouselImagens" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
					<button class="carousel-control-next" data-bs-target="#carouselImagens" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
				</div>`;
			new bootstrap.Modal(document.getElementById("modalImagem")).show();
			setTimeout(inicializarZoom, 300);
		}

		function inicializarZoom() {
			document.querySelectorAll('.zoomable').forEach(img => {
				let scale = 1;
				img.addEventListener('click', () => {
					scale = (scale === 1) ? 2 : 1;
					img.style.transform = `scale(${scale})`;
					img.classList.toggle('zoomed', scale > 1);
				});
			});
		}

		async function carregarDados() {
			carregarCarrinho();
			try {
				const response = await fetch("catalogo/tenis.json");
				tenis = await response.json();
				renderizarMarcas(tenis);
			} catch (e) { console.error("Erro ao carregar dados:", e); }
		}

		carregarDados();
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
