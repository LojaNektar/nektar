<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cat√°logo de Perfumes √Årabes</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/index.css">
	
	<style>
		.carrinho-flutuante {
			position: fixed;
			bottom: 20px;
			right: 20px;
			background-color: #25D366; /* Cor do WhatsApp */
			color: white;
			border: none;
			border-radius: 50px;
			padding: 15px 25px;
			font-size: 1.1em;
			font-weight: bold;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
			cursor: pointer;
			z-index: 1000;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: background-color 0.3s;
		}

		.carrinho-flutuante:hover {
			background-color: #128C7E;
		}

		#contadorCarrinho {
			background-color: #ffc107;
			color: #333;
			border-radius: 50%;
			padding: 4px 8px;
			font-size: 0.9em;
			line-height: 1;
		}
		
		/* Ajuste para o bot√£o no card */
		.btn-add-carrinho {
		    background-color: #198754; /* Verde do Success */
		    color: white;
		    border: none;
		    transition: background-color 0.3s;
		}
		
		.btn-add-carrinho:hover {
		    background-color: #157347;
		    color: white;
		}
		
		/* Estilo para garantir que o card-body tenha padding na parte inferior */
		.card-body {
			padding-bottom: 15px !important;
		}
	</style>
</head>

<body>
	<div class="container py-4">
		<h1 class="text-center mb-4">Cat√°logo de Perfumes √Årabes</h1>

		<div class="row mb-4">
			<nav class="col-12 d-flex gap-2 flex-wrap justify-content-center" aria-label="Menu principal">
				<a href="index.html" class="btn-grad btn btn-outline-primary">In√≠cio</a>
				<a href="perfumes.html" class="btn-grad btn btn-outline-primary">Importados</a>
				<a href="arabes.html" class="btn-grad btn btn-outline-primary">√Årabes</a>
				<a href="tenis.html" class="btn-grad btn btn-outline-primary">T√™nis</a>
			</nav>
		</div>

		<div class="row mb-4">
			<div class="col-md-6 mx-auto">
				<input type="text" id="search" class="form-control" placeholder="üîç Buscar perfume ou marca...">
			</div>
		</div>

		<div class="categorias-header mb-4">
			<h5>Filtrar por Marca</h5>
			<div class="categorias-lista" id="marcasTabs"></div>
		</div>

		<div id="catalogoContainer"></div>
	</div>

	<button id="abrirCarrinho" class="carrinho-flutuante" onclick="gerarMensagemWhatsApp()">
	    üõí Pedido WhatsApp (<span id="contadorCarrinho">0</span>)
	</button>
	<script>
		let perfumes = [];
		const generos = { "MASC": "Masculino", "FEM": "Feminino", "UNI": "Unissex" };
		const NUMERO_WHATSAPP = "5537998195214";
		let carrinho = [];

		// --- Fun√ß√µes de Carrinho ---
		function carregarCarrinho() {
			try {
				carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
			} catch (e) {
				console.error("Erro ao carregar carrinho do localStorage:", e);
				carrinho = [];
			}
			atualizarContadorCarrinho();
		}
		
		function salvarCarrinho() {
		    localStorage.setItem('carrinho', JSON.stringify(carrinho));
		    atualizarContadorCarrinho();
		}

		function atualizarContadorCarrinho() {
			const contador = document.getElementById('contadorCarrinho');
			if (contador) {
				contador.innerText = carrinho.length;
			}
		}

		function adicionarAoCarrinho(perfume, marca, venda) {
			const item = {
				perfume: perfume,
				marca: marca,
				preco: venda,
				id: Date.now() 
			};
			carrinho.push(item);
			salvarCarrinho();
			alert(`${perfume} (${marca}) foi adicionado ao seu pedido!`);
		}
		
		function gerarMensagemWhatsApp() {
		    if (carrinho.length === 0) {
		        alert("Seu pedido est√° vazio. Adicione um ou mais perfumes!");
		        return;
		    }
		
		    let mensagem = "Ol√°! Tenho interesse nos seguintes perfumes:\n\n";
		    let totalEstimado = 0;
		
		    carrinho.forEach((item, index) => {
		        // Extrai o valor do pre√ßo para c√°lculo (R$ 469,90 -> 469.90)
		        const precoLimpo = item.preco.replace('R$', '').replace('.', '').replace(',', '.').trim();
		        const valorItem = parseFloat(precoLimpo) || 0;
		        totalEstimado += valorItem;
		
		        mensagem += `${index + 1}. ${item.perfume} (${item.marca}) - ${item.preco}\n`;
		    });
		
		    // Formata o total de volta para moeda
		    const totalFormatado = totalEstimado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
		    
		    mensagem += `\nTotal Estimado: ${totalFormatado}`;
		    mensagem += `\n*Aten√ß√£o: Os valores s√£o estimados e sujeitos a confirma√ß√£o.`;
		
		    const linkWhatsApp = `https://wa.me/${NUMERO_WHATSAPP}?text=${encodeURIComponent(mensagem)}`;
		
		    window.open(linkWhatsApp, '_blank');
		    
		    // Opcional: Esvaziar o carrinho ap√≥s o envio
		    // carrinho = [];
		    // salvarCarrinho();
		}
		
		// --- Fun√ß√µes de Renderiza√ß√£o e Cat√°logo (Modificadas) ---

		function renderizarMarcas(lista) {
			const marcas = [...new Set(lista.map(p => p.Marca))].sort();
			const tabs = document.getElementById("marcasTabs");
			const container = document.getElementById("catalogoContainer");

			tabs.innerHTML = "";
			container.innerHTML = "";

			marcas.forEach(marca => {
				const marcaId = marca.toLowerCase().replace(/[^a-z0-9]+/g, "-");

				// Bot√£o de navega√ß√£o
				tabs.innerHTML += `
					<button onclick="scrollToSection('${marcaId}')">${marca}</button>
				`;

				// Dados filtrados por marca
				const perfumesDaMarca = lista.filter(p => p.Marca === marca);
				container.innerHTML += gerarHTMLMarca(marca, perfumesDaMarca);
			});
		}

		function gerarHTMLMarca(marca, itens) {
			const agrupados = Object.keys(generos).map(gen => ({
				genero: generos[gen],
				itens: itens.filter(p => (p.Genero || "").toUpperCase() === gen)
			})).filter(g => g.itens.length > 0);

			return `
				<section id="${marca.toLowerCase().replace(/[^a-z0-9]+/g, "-")}" class="mb-5">
					<h3 class="text-gradient mb-3">${marca}</h3>
					${agrupados.map(g => `
						<div class="categoria mb-4">
							<h4 class="mb-3">${g.genero}</h4>
							<div class="row g-3">
								${g.itens.map(p => `
									<div class="col-6 col-md-4 col-lg-3">
										<div class="card h-100" >
											<img src="${p.Imagem || 'img/em-breve.webp'}" alt="${p.Perfume}">
											<div class="card-body">
												<h5>${p.Perfume} - ${p.ml}</h5>
												<p><strong>Marca:</strong> ${p.Marca}</p>
												<p>${p.Tipo || 'EDP'} a partir de <strong>${p.Venda}</strong></p>
												${p.OBS ? `<p><em>${p.OBS}</em></p>` : ""}
												<p>* Valor sujeito a altera√ß√£o</p>
												
												<button onclick="adicionarAoCarrinho('${p.Perfume}', '${p.Marca}', '${p.Venda}')" 
													class="btn btn-sm btn-add-carrinho w-100">
													üõçÔ∏è Adicionar ao Pedido
												</button>
											</div>
										</div>
									</div>
								`).join("")}
							</div>
						</div>
					`).join("")}
				</section>
			`;
		}

		function scrollToSection(id) {
			const section = document.getElementById(id);
			if (section) section.scrollIntoView({ behavior: "smooth", block: "start" });
		}

		async function carregarDados() {
			carregarCarrinho(); // Carrega o carrinho antes de tudo
			try {
				const response = await fetch("catalogo/arabes.json");
				if (!response.ok) throw new Error("Falha no fetch do JSON");
				perfumes = await response.json();
				renderizarMarcas(perfumes);
				setTimeout(() => {
					const hash = window.location.hash.replace("#", "");
					if (hash) {
						const target = document.getElementById(hash);
						if (target) {
							target.scrollIntoView({ behavior: "smooth", block: "start" });
						}
					}
				}, 400); // aguarda o DOM renderizar
			} catch (error) {
				console.error("Erro ao carregar JSON:", error);
			}
		}

		document.getElementById("search").addEventListener("input", e => {
			const termo = e.target.value.toLowerCase();
			const filtrados = perfumes.filter(p =>
				p.Perfume.toLowerCase().includes(termo) ||
				p.Marca.toLowerCase().includes(termo)
			);
			renderizarMarcas(filtrados);
		});

		carregarDados();
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<footer>
		¬© 2025 Nektar. Todos os direitos reservados.<br>
		<small>Feito com üíô e estilo.</small>
	</footer>
</body>

</html>
