<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cat√°logo de Perfumes √Årabes</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/index.css">
</head>

<body>
	<div class="container py-4">
		<h1 class="text-center mb-4">Cat√°logo de Perfumes √Årabes</h1>

		<!-- Navega√ß√£o -->
		<div class="row mb-4">
			<nav class="col-12 d-flex gap-2 flex-wrap justify-content-center" aria-label="Menu principal">
				<a href="index.html" class="btn-grad btn btn-outline-primary">In√≠cio</a>
				<a href="perfumes.html" class="btn-grad btn btn-outline-primary">Importados</a>
				<a href="arabes.html" class="btn-grad btn btn-outline-primary">√Årabes</a>
				<a href="tenis.html" class="btn-grad btn btn-outline-primary">T√™nis</a>
			</nav>
		</div>

		<!-- Campo de busca -->
		<div class="row mb-4">
			<div class="col-md-6 mx-auto">
				<input type="text" id="search" class="form-control" placeholder="üîç Buscar perfume ou marca...">
			</div>
		</div>

		<!-- Header de categorias -->
		<div class="categorias-header mb-4">
			<h5>Filtrar por Marca</h5>
			<div class="categorias-lista" id="marcasTabs"></div>
		</div>

		<!-- Container das marcas -->
		<div id="catalogoContainer"></div>
	</div>

	<script>
		let perfumes = [];
		const generos = { "MASC": "Masculino", "FEM": "Feminino", "UNI": "Unissex" };

		function renderizarMarcas(lista) {
			const marcas = [...new Set(lista.map(p => p.Marca))].sort();
			const tabs = document.getElementById("marcasTabs");
			const container = document.getElementById("catalogoContainer");

			tabs.innerHTML = "";
			container.innerHTML = "";

			marcas.forEach(marca => {
				const marcaId = marca.toLowerCase().replace(/[^a-z0-9]+/g, "-");

				// Bot√£o de navega√ß√£o
				tabs.innerHTML += `
					<button onclick="scrollToSection('${marcaId}')">${marca}</button>
				`;

				// Dados filtrados por marca
				const perfumesDaMarca = lista.filter(p => p.Marca === marca);
				container.innerHTML += gerarHTMLMarca(marca, perfumesDaMarca);
			});
		}

		function gerarHTMLMarca(marca, itens) {
			const agrupados = Object.keys(generos).map(gen => ({
				genero: generos[gen],
				itens: itens.filter(p => (p.Genero || "").toUpperCase() === gen)
			})).filter(g => g.itens.length > 0);

			return `
				<section id="${marca.toLowerCase().replace(/[^a-z0-9]+/g, "-")}" class="mb-5">
					<h3 class="text-gradient mb-3">${marca}</h3>
					${agrupados.map(g => `
						<div class="categoria mb-4">
							<h4 class="mb-3">${g.genero}</h4>
							<div class="row g-3">
								${g.itens.map(p => `
									<div class="col-6 col-md-4 col-lg-3">
										<div class="card h-100" >
											<img src="${p.Imagem || 'img/em-breve.webp'}" alt="${p.Perfume}">
											<div class="card-body">
												<h5>${p.Perfume} - ${p.ml}</h5>
												<p><strong>Marca:</strong> ${p.Marca}</p>
												<p>${p.Tipo || 'EDP'} a partir de <strong>${p.Venda}</strong></p>
												${p.OBS ? `<p><em>${p.OBS}</em></p>` : ""}
												<p>* Valor sujeito a altera√ß√£o</p>
												<a href="https://wa.me/5537998195214?text=Ol√°!%20Tenho%20interesse%20no%20perfume%20${encodeURIComponent(p.Marca)}%20${encodeURIComponent(p.Perfume)}." 
													target="_blank" class="badge-what">üí¨ Falar no WhatsApp</a>
											</div>
										</div>
									</div>
								`).join("")}
							</div>
						</div>
					`).join("")}
				</section>
			`;
		}

		function scrollToSection(id) {
			const section = document.getElementById(id);
			if (section) section.scrollIntoView({ behavior: "smooth", block: "start" });
		}

		function abrirOpcoes(nomePerfume) {
			const modal = new bootstrap.Modal(document.getElementById("modalOpcoes"));
			document.querySelector("#modalOpcoes .modal-title").innerText = nomePerfume + " ‚Äì outras op√ß√µes";
			modal.show();
		}

		async function carregarDados() {
			try {
				const response = await fetch("catalogo/arabes.json");
				if (!response.ok) throw new Error("Falha no fetch do JSON");
				perfumes = await response.json();
				renderizarMarcas(perfumes);
				setTimeout(() => {
			      const hash = window.location.hash.replace("#", "");
			      if (hash) {
			        const target = document.getElementById(hash);
			        if (target) {
			          target.scrollIntoView({ behavior: "smooth", block: "start" });
			        }
			      }
			    }, 400); // aguarda o DOM renderizar
			} catch (error) {
				console.error("Erro ao carregar JSON:", error);
			}
		}

		document.getElementById("search").addEventListener("input", e => {
			const termo = e.target.value.toLowerCase();
			const filtrados = perfumes.filter(p =>
				p.Perfume.toLowerCase().includes(termo) ||
				p.Marca.toLowerCase().includes(termo)
			);
			renderizarMarcas(filtrados);
		});

		carregarDados();
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<footer>
		¬© 2025 Nektar. Todos os direitos reservados.<br>
		<small>Feito com üíô e estilo.</small>
	</footer>
</body>

</html>
