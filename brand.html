<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cat√°logo de Brand Collection</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/index.css" />

    <style>
      .carrinho-flutuante {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #25d366;
        color: white;
        border: none;
        border-radius: 50px;
        padding: 15px 25px;
        font-size: 1.1em;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .carrinho-flutuante:hover {
        background-color: #128c7e;
      }

      #contadorCarrinho {
        background-color: #ffc107;
        color: #333;
        border-radius: 50%;
        padding: 4px 8px;
        font-size: 0.9em;
      }

      .btn-add-carrinho {
        background-color: #198754;
        color: white;
        border: none;
      }

      .btn-add-carrinho:hover {
        background-color: #157347;
        color: white;
      }

      .card-body {
        padding-bottom: 15px !important;
      }

      #modalCarrinho .modal-footer {
        border-top: none;
        padding-top: 0;
      }

      #modalCarrinho .modal-body {
        padding-bottom: 0;
      }
    </style>
  </head>

  <body>
    <div class="container py-4">
      <h1 class="text-center mb-4">Cat√°logo de Perfumes √Årabes</h1>

      <div class="row mb-4">
        <nav class="col-12 d-flex gap-2 flex-wrap justify-content-center">
          <a href="index.html" class="btn btn-outline-primary">In√≠cio</a>
          <a href="perfumes.html" class="btn btn-outline-primary">Importados</a>
          <a href="arabes.html" class="btn btn-outline-primary">√Årabes</a>
          <a href="tenis.html" class="btn btn-outline-primary">T√™nis</a>
        </nav>
      </div>

      <div class="row mb-4">
        <div class="col-md-6 mx-auto">
          <input
            type="text"
            id="search"
            class="form-control"
            placeholder="üîç Buscar perfume..."
          />
        </div>
      </div>

      <div id="catalogoContainer"></div>
    </div>

    <!-- BOT√ÉO CARRINHO -->
    <button class="carrinho-flutuante" onclick="abrirModalCarrinho()">
      üõí Meu Pedido (<span id="contadorCarrinho">0</span>)
    </button>

    <!-- MODAL CARRINHO -->
    <div class="modal fade" id="modalCarrinho" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">üõí Seu Pedido</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div id="itensCarrinhoLista"></div>
          </div>
          <div class="modal-footer flex-column">
            <p class="h4 text-end mb-3" id="carrinhoTotal">
              Total Estimado: R$ 0,00
            </p>
            <button
              class="btn btn-success btn-lg w-100"
              onclick="finalizarPedidoWhatsApp()"
            >
              ‚úÖ Finalizar Pedido no WhatsApp
            </button>
            <button
              class="btn btn-outline-secondary mt-2"
              data-bs-dismiss="modal"
            >
              Continuar Comprando
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let perfumes = [];
      let carrinho = [];
      const NUMERO_WHATSAPP = "5537998195214";

      function carregarCarrinho() {
        carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
        atualizarContadorCarrinho();
      }

      function salvarCarrinho() {
        localStorage.setItem("carrinho", JSON.stringify(carrinho));
        atualizarContadorCarrinho();
      }

      function atualizarContadorCarrinho() {
        document.getElementById("contadorCarrinho").innerText = carrinho.length;
      }

      function adicionarAoCarrinho(nome, venda) {
        carrinho.push({
          nome,
          preco: venda,
          id: Date.now(),
        });
        salvarCarrinho();
        alert(`${nome} adicionado ao pedido!`);
      }

      function removerDoCarrinho(id) {
        carrinho = carrinho.filter((i) => i.id !== id);
        salvarCarrinho();
        abrirModalCarrinho(true);
      }

      function stringParaFloat(v) {
        return parseFloat(v.replace("R$", "").replace(",", ".")) || 0;
      }

      function abrirModalCarrinho(reabrir = false) {
        if (carrinho.length === 0 && !reabrir) {
          alert("Carrinho vazio");
          return;
        }

        let html = `<ul class="list-group list-group-flush">`;
        let total = 0;

        carrinho.forEach((item) => {
          total += stringParaFloat(item.preco);
          html += `
            <li class="list-group-item d-flex justify-content-between">
              <div>
                ${item.nome}<br>
                <small>${item.preco}</small>
              </div>
              <button class="btn btn-sm btn-danger"
                onclick="removerDoCarrinho(${item.id})">Remover</button>
            </li>`;
        });

        html += `</ul>`;
        document.getElementById("itensCarrinhoLista").innerHTML = html;
        document.getElementById("carrinhoTotal").innerText =
          "Total Estimado: " +
          total.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });

        if (!reabrir) {
          new bootstrap.Modal(document.getElementById("modalCarrinho")).show();
        }
      }

      function finalizarPedidoWhatsApp() {
        let msg = "Ol√°! Gostaria de finalizar o pedido:\n\n";
        let total = 0;

        carrinho.forEach((i, idx) => {
          total += stringParaFloat(i.preco);
          msg += `${idx + 1}. ${i.nome} - ${i.preco}\n`;
        });

        msg += `\nTotal Estimado: ${total.toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL",
        })}`;

        window.open(
          `https://wa.me/${NUMERO_WHATSAPP}?text=${encodeURIComponent(msg)}`,
          "_blank"
        );
      }

      function renderizarCatalogo(lista) {
        const c = document.getElementById("catalogoContainer");
        let html = `<div class="row g-3">`;

        lista.forEach((p) => {
          html += `
            <div class="col-6 col-md-4 col-lg-3">
              <div class="card h-100">
                <img src="${p.Imagem}" alt="${p.Perfume}">
                <div class="card-body">
                  <h5>${p.Perfume}</h5>
                  <p><strong>${p.Venda}</strong></p>
                  <button class="btn btn-sm btn-add-carrinho w-100"
                    onclick="adicionarAoCarrinho('${p.Perfume}', '${p.Venda}')">
                    üõçÔ∏è Adicionar ao Pedido
                  </button>
                </div>
              </div>
            </div>`;
        });

        html += `</div>`;
        c.innerHTML = html;
      }

      async function carregarDados() {
        carregarCarrinho();
        try {
          const response = await fetch("brand.json");
          if (!response.ok) throw new Error("Falha no fetch do JSON");
          perfumes = await response.json();
          renderizarMarcas(perfumes);
          setTimeout(() => {
            const hash = window.location.hash.replace("#", "");
            if (hash) {
              const target = document.getElementById(hash);
              if (target) {
                target.scrollIntoView({ behavior: "smooth", block: "start" });
              }
            }
          }, 400);
        } catch (error) {
          console.error("Erro ao carregar JSON:", error);
        }
      }

      document.getElementById("search").addEventListener("input", (e) => {
        const t = e.target.value.toLowerCase();
        renderizarCatalogo(
          perfumes.filter((p) => p.Perfume.toLowerCase().includes(t))
        );
      });

      carregarDados();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <footer class="text-center mt-4">
      ¬© 2025 Nektar. Todos os direitos reservados.<br />
      <small>Feito com üíô e estilo.</small>
    </footer>
  </body>
</html>
